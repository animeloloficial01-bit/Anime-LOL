<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="./manifest.json">
    <title>ANIME LOL | IA CORE V10</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --p: #47d1e0; --bg: #000; --s: #0a0a0a; --t: #fff; --d: #ff4757; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--t); min-height: 100vh; overflow-x: hidden; }

        /* Login */
        #auth { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: var(--s); padding: 35px; border-radius: 25px; border: 1px solid var(--p); width: 100%; max-width: 400px; text-align: center; box-shadow: 0 0 30px rgba(71,209,224,0.2); }
        .auth-card input { width: 100%; padding: 12px; margin: 10px 0; background: #111; border: 1px solid #333; color: #fff; border-radius: 12px; outline: none; }
        
        /* Layout */
        header { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; background: rgba(0,0,0,0.95); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(10px); }
        .app-main { display: grid; grid-template-columns: 1fr 340px; gap: 20px; padding: 20px 5%; }

        /* Filtros Pro */
        .filter-panel { background: var(--s); padding: 15px; border-radius: 15px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; border: 1px solid #222; }
        select, .in-search { background: #161616; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 8px; font-size: 0.8rem; outline: none; }
        .btn { background: var(--p); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .btn:active { transform: scale(0.95); }

        /* Grid & Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(155px, 1fr)); gap: 15px; }
        .card { background: #111; border-radius: 15px; overflow: hidden; border: 1px solid #222; position: relative; cursor: pointer; transition: 0.4s; }
        .card:hover { border-color: var(--p); transform: translateY(-5px); }
        .card img { width: 100%; height: 220px; object-fit: cover; }
        .card-body { padding: 10px; }
        .card-title { font-size: 0.75rem; font-weight: 700; height: 35px; overflow: hidden; }
        
        .badge { position: absolute; top: 8px; padding: 4px 8px; border-radius: 6px; font-size: 0.6rem; font-weight: 900; z-index: 10; }
        .b-match { left: 8px; background: rgba(0,0,0,0.8); color: var(--p); border: 1px solid var(--p); }
        .b-censura { right: 8px; background: var(--d); color: #fff; }

        /* Chat */
        .sidebar { background: var(--s); border: 1px solid #222; border-radius: 20px; height: 600px; display: flex; flex-direction: column; position: sticky; top: 90px; }
        #chat-box { flex: 1; padding: 15px; overflow-y: auto; font-size: 0.8rem; }
        .msg { background: #161616; padding: 10px; border-radius: 12px; margin-bottom: 8px; border-left: 3px solid var(--p); }

        /* Modal & Video */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 6000; padding: 20px; overflow-y: auto; }
        .modal-wrap { max-width: 700px; margin: auto; }
        .vid-box { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 20px; overflow: hidden; background: #000; border: 1px solid #333; }
        .vid-box iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .ia-resumen { background: rgba(71,209,224,0.05); border: 1px solid var(--p); padding: 18px; border-radius: 15px; margin: 20px 0; font-size: 0.9rem; line-height: 1.6; }

        @media (max-width: 900px) { .app-main { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div id="auth">
        <div class="auth-card">
            <img src="1000371388.png" width="60" style="margin-bottom:15px; filter: drop-shadow(0 0 10px var(--p));">
            <h2 style="color:var(--p); margin-bottom:5px;">ANIME LOL IA</h2>
            <p style="font-size:0.7rem; color:#666; margin-bottom:20px;">PROTOCOLO DE ACCESO REQUERIDO</p>
            <input type="text" id="u-in" placeholder="ID de Usuario">
            <input type="password" id="p-in" placeholder="Clave de Enlace">
            <button class="btn" style="width:100%;" onclick="startApp()">ACCEDER AL N√öCLEO</button>
        </div>
    </div>

    <header>
        <div style="display:flex; align-items:center; gap:10px;">
            <img src="1000371388.png" height="30" onerror="this.style.display='none'">
            <span style="color:var(--p); font-weight:900; letter-spacing:1px;">ANIME LOL</span>
        </div>
        <div id="u-tag" style="font-size:0.7rem; color:var(--p); font-weight:700;">@OFFLINE</div>
    </header>

    <main class="app-main">
        <section>
            <div class="filter-panel">
                <input type="text" id="f-name" class="in-search" placeholder="Nombre...">
                <select id="f-genre">
                    <option value="">G√©nero</option>
                    <option value="1">Acci√≥n</option><option value="10">Fantas√≠a</option><option value="22">Romance</option><option value="4">Comedia</option>
                </select>
                <select id="f-type">
                    <option value="">Origen</option>
                    <option value="tv">Jap√≥n (TV)</option>
                    <option value="ona">Web (China/Corea)</option>
                </select>
                <input type="number" id="f-year" class="in-search" placeholder="A√±o" min="1990" max="2026">
                <button class="btn" onclick="fetchAnime()"><i class="fas fa-search"></i></button>
            </div>

            <button class="btn" style="width:100%; margin-bottom:20px; background:linear-gradient(45deg, var(--p), #9b59b6); color:#fff;" onclick="oracle()">üîÆ CONSULTAR OR√ÅCULO IA</button>

            <div class="grid" id="main-grid"></div>
        </section>

        <aside>
            <div class="sidebar">
                <div style="padding:15px; border-bottom:1px solid #222; font-size:0.7rem; font-weight:900; color:var(--p); text-align:center;">üì° CANAL DE COMUNIDAD GLOBAL</div>
                <div id="chat-box"></div>
                <div style="padding:15px; display:flex; gap:8px;">
                    <input type="text" id="c-input" placeholder="Escribe..." style="flex:1; background:#111; border:1px solid #333; color:#fff; padding:8px; border-radius:8px; font-size:0.8rem;">
                    <button onclick="sendMsg()" style="background:var(--p); border:none; padding:8px 12px; border-radius:8px;"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </aside>
    </main>

    <div id="modal">
        <div class="modal-wrap">
            <button class="btn" style="background:#222; color:#fff; margin-bottom:20px;" onclick="closeM()">‚úï CERRAR</button>
            <div class="vid-box" id="v-box"></div>
            <h2 id="m-title" style="color:var(--p); margin-top:20px; font-size:1.8rem;"></h2>
            
            <div class="ia-resumen">
                <h4 style="color:var(--p); font-size:0.7rem; margin-bottom:8px; text-transform:uppercase;">üí° Resumen e Inteligencia IA:</h4>
                <p id="m-desc"></p>
            </div>

            <div id="m-meta" style="color:#777; font-size:0.8rem; margin-bottom:20px; display:flex; gap:15px;"></div>
            <button id="cap-btn" class="btn" style="width:100%; background:none; border:1px solid var(--p); color:var(--p);">MARCAR √öLTIMO CAP√çTULO</button>
        </div>
    </div>

    <script>
        let currentUser = "";

        function startApp() {
            const u = document.getElementById('u-in').value;
            if(u.length < 2) return alert("ID Requerido");
            currentUser = u;
            document.getElementById('u-tag').innerText = `@${u.toUpperCase()}`;
            document.getElementById('auth').style.display = 'none';
            fetchAnime();
        }

        async function fetchAnime() {
            const grid = document.getElementById('main-grid');
            const name = document.getElementById('f-name').value;
            const genre = document.getElementById('f-genre').value;
            const type = document.getElementById('f-type').value;
            const year = document.getElementById('f-year').value;

            grid.innerHTML = "<p>Iniciando escaneo de red...</p>";
            
            // Fix de conexi√≥n: HTTPS forzado + Anti-Cache
            let url = `https://api.jikan.moe/v4/anime?q=${name}&limit=16&genres=${genre}&type=${type}&start_date=${year ? year+'-01-01' : ''}&order_by=score&sort=desc&_=${new Date().getTime()}`;
            
            try {
                const res = await fetch(url);
                if(!res.ok) throw new Error();
                const { data } = await res.json();
                
                grid.innerHTML = '';
                data.forEach(a => {
                    const match = Math.floor(Math.random() * 20) + 79;
                    const isNSFW = a.rating && (a.rating.includes('R') || a.rating.includes('Rx'));
                    const myCap = localStorage.getItem(`cap_${a.mal_id}`) || "1";

                    grid.innerHTML += `
                        <div class="card" onclick='openM(${JSON.stringify(a).replace(/'/g, "&apos;")})'>
                            <div class="badge b-match">${match}% MATCH</div>
                            ${isNSFW ? '<div class="badge b-censura">+18</div>' : '<div class="badge" style="background:green; right:8px; color:white;">S/C</div>'}
                            <img src="${a.images.jpg.large_image_url}" loading="lazy">
                            <div class="card-body">
                                <div class="card-title">${a.title}</div>
                                <div style="font-size:0.6rem; color:#666; margin-top:5px;">Cap. Actual: ${myCap}</div>
                            </div>
                        </div>
                    `;
                });
            } catch (e) {
                grid.innerHTML = "<p style='color:var(--d)'>Error de Enlace: La API est√° saturada. Espera 5 seg.</p>";
            }
        }

        function openM(a) {
            document.getElementById('m-title').innerText = a.title;
            
            // Traductor y Resumen IA
            let desc = a.synopsis ? a.synopsis : "Sin descripci√≥n disponible.";
            document.getElementById('m-desc').innerText = desc
                .replace(/is a/g, "es un").replace(/The story/g, "La historia")
                .substring(0, 300) + "... [An√°lisis IA: Obra de alta fidelidad tipo " + a.type + "].";

            const vBox = document.getElementById('v-box');
            if(a.trailer && a.trailer.youtube_id) {
                vBox.innerHTML = `<iframe src="https://www.youtube.com/embed/${a.trailer.youtube_id}?autoplay=1" allowfullscreen></iframe>`;
            } else {
                vBox.innerHTML = "<div style='padding:60px; text-align:center;'>Trailer no disponible</div>";
            }

            document.getElementById('m-meta').innerHTML = `<span>A√±o: ${a.year || 'N/A'}</span> <span>Rating: ${a.rating}</span> <span>Score: ‚òÖ${a.score}</span>`;
            
            document.getElementById('cap-btn').onclick = () => {
                const c = prompt("N√∫mero de cap√≠tulo:", "1");
                if(c) {
                    localStorage.setItem(`cap_${a.mal_id}`, c);
                    fetchAnime();
                    alert("Progreso guardado.");
                }
            };

            document.getElementById('modal').style.display = 'block';
        }

        function closeM() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('v-box').innerHTML = '';
        }

        function sendMsg() {
            const inpt = document.getElementById('c-input');
            const box = document.getElementById('chat-box');
            if(!inpt.value) return;
            const d = document.createElement('div');
            d.className = 'msg';
            d.innerHTML = `<b>@${currentUser}:</b> ${inpt.value}`;
            box.appendChild(d);
            inpt.value = '';
            box.scrollTop = box.scrollHeight;
        }

        function oracle() {
            const r = ["Solo Leveling", "Chainsaw Man", "Oshi no Ko", "Frieren", "Bleach TYBW"];
            alert("üîÆ OR√ÅCULO IA: Basado en tus ondas cerebrales, deber√≠as ver: " + r[Math.floor(Math.random()*r.length)]);
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').catch(e => console.log(e));
        }
    </script>
</body>
</html>
        
