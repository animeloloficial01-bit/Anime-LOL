<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Anime LOL | Buscador & IA</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #47d1e0;
            --primary-glow: rgba(71, 209, 224, 0.4);
            --bg: #000000;
            --surface: #121212;
            --text: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); min-height: 100vh; }

        header {
            padding: 1rem 5%;
            display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(15px); border-bottom: 1px solid rgba(71, 209, 224, 0.2);
            position: sticky; top: 0; z-index: 1000; background: rgba(0,0,0,0.8);
        }

        .logo img { height: 35px; filter: drop-shadow(0 0 5px var(--primary)); }

        /* --- BUSCADOR --- */
        .search-container { padding: 15px 5%; background: linear-gradient(to bottom, rgba(71,209,224,0.1), transparent); }
        .search-bar {
            display: flex; background: #1a1a1a; border-radius: 12px; padding: 5px 15px;
            border: 1px solid #333; align-items: center;
        }
        .search-bar input {
            flex: 1; background: transparent; border: none; color: white; padding: 10px; outline: none;
        }
        .search-bar i { color: var(--primary); }

        .user-panel { background: rgba(255,255,255,0.05); margin: 10px 5%; padding: 12px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }

        /* --- LAYOUT --- */
        .main-content { display: grid; grid-template-columns: 1fr 350px; gap: 20px; padding: 0 5% 40px; }
        .anime-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }

        .anime-card { background: #111; border-radius: 12px; overflow: hidden; border: 1px solid #222; position: relative; cursor: pointer; transition: 0.3s; }
        .anime-card:hover { border-color: var(--primary); transform: scale(1.03); }
        .anime-card img { width: 100%; height: 210px; object-fit: cover; }

        .match-badge { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.8); color: var(--primary); padding: 3px 6px; border-radius: 5px; font-size: 0.6rem; font-weight: 900; border: 1px solid var(--primary); }

        .anime-info { padding: 10px; }
        .anime-title { font-size: 0.75rem; font-weight: 700; height: 34px; overflow: hidden; margin-bottom: 5px; }

        /* --- MODAL DE DETALLES --- */
        #modal-detalles {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 2000; padding: 40px 20px; overflow-y: auto;
        }
        .modal-content { max-width: 500px; margin: auto; }
        .modal-content img { width: 100%; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 0 20px var(--primary-glow); }
        .btn-cerrar { background: var(--primary); color: black; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 900; margin-bottom: 20px; cursor: pointer; }

        /* --- CHAT --- */
        .chat-box { background: var(--surface); border-radius: 20px; border: 1px solid #222; height: 450px; display: flex; flex-direction: column; overflow: hidden; }
        .chat-msgs { flex: 1; padding: 15px; overflow-y: auto; font-size: 0.8rem; }
        .message { background: #1a1a1a; padding: 10px; border-radius: 10px; margin-bottom: 8px; border-left: 3px solid var(--primary); }
        .chat-input { padding: 10px; display: flex; gap: 8px; background: #000; }
        .chat-input input { flex: 1; background: #1a1a1a; border: 1px solid #333; color: white; padding: 8px; border-radius: 8px; }
        .chat-input button { background: var(--primary); border: none; padding: 0 12px; border-radius: 8px; }

        @media (max-width: 900px) { .main-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <img src="1000371388.png" alt="Logo" onerror="this.style.display='none'">
            <span style="color:var(--primary); font-weight:900; margin-left:8px; letter-spacing:1px;">ANIME LOL</span>
        </div>
        <i class="fas fa-bars" style="color:var(--primary)"></i>
    </header>

    <div class="search-container">
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="input-busqueda" placeholder="Buscar anime por nombre...">
        </div>
    </div>

    <div class="user-panel">
        <div><span style="color:var(--primary); font-weight:700;" id="user-display">@Cargando...</span></div>
        <div style="font-size: 0.6rem; background: var(--primary); color: black; padding: 3px 8px; border-radius: 20px; font-weight: 900;">PRO USER</div>
    </div>

    <main class="main-content">
        <section>
            <h3 id="titulo-seccion" style="margin-bottom:15px; font-size:0.8rem; text-transform:uppercase; color:var(--primary);">Tendencias IA</h3>
            <div class="anime-grid" id="anime-feed">
                </div>
        </section>

        <aside>
            <div class="chat-box">
                <div style="padding:12px; text-align:center; border-bottom:1px solid #222; font-weight:900; color:var(--primary); font-size:0.7rem;">CHAT GLOBAL</div>
                <div class="chat-msgs" id="chat-render">
                    <div class="message"><b>IA:</b> Hola. Busca un anime arriba para analizar su compatibilidad.</div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chat-in" placeholder="Escribe...">
                    <button id="chat-btn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </aside>
    </main>

    <div id="modal-detalles">
        <div class="modal-content">
            <button class="btn-cerrar" onclick="cerrarModal()"> <i class="fas fa-arrow-left"></i> VOLVER</button>
            <img id="m-img" src="">
            <h2 id="m-titulo" style="color:var(--primary); margin-bottom:10px;"></h2>
            <p id="m-sinopsis" style="font-size:0.9rem; line-height:1.6; opacity:0.8; margin-bottom:20px;"></p>
            <div id="m-info-extra" style="background:#1a1a1a; padding:15px; border-radius:10px; font-size:0.8rem;"></div>
            <br>
            <button id="btn-recordar" style="width:100%; background:none; border:1px solid var(--primary); color:var(--primary); padding:10px; border-radius:10px; font-weight:700;">MARCAR CAPÍTULO</button>
        </div>
    </div>

    <script>
        const feed = document.getElementById('anime-feed');
        const inputBusqueda = document.getElementById('input-busqueda');

        // 1. CARGAR ANIMES (TENDENCIA O BÚSQUEDA)
        async function buscarAnimes(query = '') {
            feed.innerHTML = '<p style="padding:20px;">Sincronizando...</p>';
            let url = query 
                ? `https://api.jikan.moe/v4/anime?q=${query}&limit=12` 
                : 'https://api.jikan.moe/v4/top/anime?filter=airing&limit=12';
            
            try {
                const res = await fetch(url);
                const { data } = await res.json();
                feed.innerHTML = '';
                data.forEach(anime => {
                    const match = Math.floor(Math.random() * 20) + 80;
                    feed.innerHTML += `
                        <div class="anime-card" onclick='abrirDetalles(${JSON.stringify(anime).replace(/'/g, "&apos;")})'>
                            <div class="match-badge">${match}% IA</div>
                            <img src="${anime.images.jpg.large_image_url}">
                            <div class="anime-info">
                                <div class="anime-title">${anime.title}</div>
                                <div style="font-size:0.6rem; color:var(--primary)">★ ${anime.score || 'N/A'}</div>
                            </div>
                        </div>
                    `;
                });
            } catch (e) { feed.innerHTML = "<p>Error de conexión.</p>"; }
        }

        // 2. BUSCADOR EN TIEMPO REAL
        inputBusqueda.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') {
                document.getElementById('titulo-seccion').innerText = "Resultados de Búsqueda";
                buscarAnimes(inputBusqueda.value);
            }
        });

        // 3. VENTANA DE DETALLES
        function abrirDetalles(anime) {
            document.getElementById('m-img').src = anime.images.jpg.large_image_url;
            document.getElementById('m-titulo').innerText = anime.title;
            document.getElementById('m-sinopsis').innerText = anime.synopsis || "Sin sinopsis disponible.";
            document.getElementById('m-info-extra').innerHTML = `
                <b>Episodios:</b> ${anime.episodes || '?'}<br>
                <b>Estado:</b> ${anime.status}<br>
                <b>Géneros:</b> ${anime.genres.map(g => g.name).join(', ')}
            `;
            
            document.getElementById('btn-recordar').onclick = () => {
                const cap = prompt("¿En qué capítulo vas?", "1");
                if(cap) localStorage.setItem(`cap_${anime.mal_id}`, cap);
            };

            document.getElementById('modal-detalles').style.display = 'block';
        }

        function cerrarModal() { document.getElementById('modal-detalles').style.display = 'none'; }

        // 4. CHAT
        const user = localStorage.getItem('animelol_user') || "User" + Math.floor(Math.random()*99);
        document.getElementById('user-display').innerText = "@" + user;

        document.getElementById('chat-btn').onclick = () => {
            const cin = document.getElementById('chat-in');
            if(cin.value.trim()){
                const d = document.createElement('div');
                d.className = 'message';
                d.innerHTML = `<b>@${user}:</b> ${cin.value}`;
                document.getElementById('chat-render').appendChild(d);
                cin.value = '';
            }
        };

        window.onload = () => buscarAnimes();
    </script>
</body>
</html>
